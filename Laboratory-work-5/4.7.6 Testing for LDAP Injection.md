# 4.7.6 Тестування на LDAP-ін'єкції

## Резюме

LDAP-ін'єкція - це атака на веб-додатки, які конструюють LDAP-запити на основі введених користувачем даних. Якщо додаток не виконує належну валідацію або екранування вхідних даних, зловмисник може змінити конструкцію LDAP-запиту.

## Цілі тестування

- Визначити точки LDAP-ін'єкцій
- Оцінити серйозність виявлених ін'єкцій

## Як тестувати

### Тестування чорної скриньки

#### Приклад 1: Фільтри пошуку

Припустимо, що веб-додаток використовує фільтр для пошуку користувачів:

```
searchfilter="(&(USER="+user+")(PASSWORD="+pass+"))"
```

Якщо значення `user` та `pass` не валідуються належним чином, можливі наступні атаки:

**Обхід автентифікації:**
- Логін: `*`
- Пароль: `*`

Це створить фільтр: `(&(USER=*)(PASSWORD=*))`

**Ін'єкція з використанням дужок:**
- Логін: `admin)(&)`
- Пароль: `test`

Це створить фільтр: `(&(USER=admin)(&))(PASSWORD=test))`

#### Приклад 2: Ін'єкція в атрибути

Якщо додаток дозволяє пошук за атрибутами:

```
searchfilter="(cn="+name+")"
```

Можливі ін'єкції:
- `*` - поверне всі об'єкти
- `admin*` - поверне всі об'єкти, що починаються з "admin"
- `admin)(|(password=*))` - спроба витягти паролі

### Тестування сірої скриньки

При тестуванні сірої скриньки аналізуйте вихідний код:

1. **Ідентифікація LDAP-запитів:**
   - Шукайте використання LDAP-бібліотек
   - Знайдіть місця формування LDAP-фільтрів

2. **Перевірка валідації:**
   - Чи виконується екранування спеціальних символів?
   - Чи використовуються параметризовані запити?

3. **Спеціальні символи для тестування:**
   - `*` - підстановочний символ
   - `()` - дужки для групування
   - `|` - логічне АБО
   - `&` - логічне І
   - `!` - логічне НЕ

## Інструменти

- **LDAP Browser** - для перегляду LDAP-структури
- **Wireshark** - для аналізу LDAP-трафіку
- **Burp Suite** - для перехоплення та модифікації запитів

## Запобігання

1. **Валідація вхідних даних:**
   - Використовуйте білі списки дозволених символів
   - Обмежуйте довжину вхідних даних

2. **Екранування спеціальних символів:**
   ```
   ( -> \28
   ) -> \29
   \ -> \5c
   * -> \2a
   / -> \2f
   ```

3. **Використання параметризованих запитів**
4. **Принцип найменших привілеїв для LDAP-з'єднань**
5. **Логування та моніторинг підозрілих запитів**

## Посилання

- [OWASP LDAP Injection Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/LDAP_Injection_Prevention_Cheat_Sheet.html)
- [RFC 4515 - LDAP Search Filters](https://www.rfc-editor.org/rfc/rfc4515)